<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Virtual Patient Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #e6f0fa 0%, #d0e4ff 100%);
            padding: 20px;
        }

        .patient-generator-container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 102, 204, 0.2);
        }

        h2 {
            color: #0066cc;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-align: center;
            background: linear-gradient(135deg, #0066cc, #3399ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .generation-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        .control-group label {
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .control-group input,
        .control-group select {
            padding: 10px;
            border: 2px solid rgba(0, 102, 204, 0.3);
            border-radius: 10px;
            background: rgba(230, 240, 250, 0.5);
            font-size: 1em;
            transition: all 0.3s;
        }

        .control-group input:focus,
        .control-group select:focus {
            outline: none;
            border-color: #0066cc;
            box-shadow: 0 0 10px rgba(0, 102, 204, 0.3);
        }

        .generate-btn {
            background: linear-gradient(135deg, #0066cc, #3399ff);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            font-weight: 600;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 20px auto;
            display: block;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 102, 204, 0.4);
        }

        .patient-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .patient-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }

        .patient-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 102, 204, 0.3);
        }

        .patient-card.selected {
            border: 3px solid #0066cc;
        }

        .patient-avatar {
            width: 100%;
            height: 280px;
            position: relative;
            background: linear-gradient(135deg, #f0f4f8, #e1e9f0);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .avatar-svg {
            width: 200px;
            height: 260px;
        }

        .patient-info {
            padding: 20px;
            background: white;
        }

        .patient-name {
            font-size: 1.2em;
            font-weight: 600;
            color: #0066cc;
            margin-bottom: 10px;
        }

        .patient-details {
            color: #555;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .patient-details span {
            display: block;
            margin-bottom: 5px;
        }

        .vital-signs {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #e0e0e0;
        }

        .vital-badge {
            background: rgba(0, 102, 204, 0.1);
            color: #0066cc;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .selection-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            background: #4CAF50;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .patient-card.selected .selection-indicator {
            display: flex;
        }

        .batch-controls {
            display: flex;
            gap: 20px;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        .stats-panel {
            background: rgba(230, 240, 250, 0.5);
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            color: #0066cc;
            font-weight: bold;
        }

        .stat-label {
            color: #555;
            font-size: 0.9em;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="patient-generator-container">
        <h2>ðŸ§¬ Virtual Patient Generator</h2>
        
        <div class="generation-controls">
            <div class="control-group">
                <label>Age Range</label>
                <select id="ageRange">
                    <option value="0-12">Pediatric (0-12)</option>
                    <option value="13-17">Adolescent (13-17)</option>
                    <option value="18-35">Young Adult (18-35)</option>
                    <option value="36-55" selected>Middle Age (36-55)</option>
                    <option value="56-70">Senior (56-70)</option>
                    <option value="71-100">Elderly (71+)</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>Gender Distribution</label>
                <select id="genderDist">
                    <option value="mixed" selected>Mixed</option>
                    <option value="male">Male Only</option>
                    <option value="female">Female Only</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>Cancer Type</label>
                <select id="cancerType">
                    <option value="mixed" selected>Mixed</option>
                    <option value="leukemia">Leukemia</option>
                    <option value="lymphoma">Lymphoma</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>Number of Patients</label>
                <input type="number" id="patientCount" min="1" max="20" value="6">
            </div>
        </div>
        
        <div class="batch-controls">
            <button class="generate-btn" onclick="generatePatientBatch()">Generate Virtual Patients</button>
            <button class="generate-btn" onclick="selectRandomPatient()">Select Random Patient</button>
        </div>
        
        <div class="stats-panel" id="statsPanel">
            <div class="stat-item">
                <div class="stat-value" id="totalPatients">0</div>
                <div class="stat-label">Total Patients</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="avgAge">--</div>
                <div class="stat-label">Average Age</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="maleCount">0</div>
                <div class="stat-label">Male Patients</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="femaleCount">0</div>
                <div class="stat-label">Female Patients</div>
            </div>
        </div>
        
        <div class="patient-gallery" id="patientGallery"></div>
    </div>

    <script>
        // Name databases for realistic patient names
        const firstNames = {
            male: ['James', 'John', 'Robert', 'Michael', 'William', 'David', 'Richard', 'Joseph', 'Thomas', 'Charles', 'Christopher', 'Daniel', 'Matthew', 'Anthony', 'Mark', 'Donald', 'Steven', 'Kenneth', 'Paul', 'Joshua'],
            female: ['Mary', 'Patricia', 'Jennifer', 'Linda', 'Elizabeth', 'Barbara', 'Susan', 'Jessica', 'Sarah', 'Karen', 'Nancy', 'Betty', 'Margaret', 'Sandra', 'Ashley', 'Dorothy', 'Kimberly', 'Emily', 'Donna', 'Michelle']
        };
        
        const lastNames = ['Smith', 'Johnson', 'Williams', 'Brown', 'Jones', 'Garcia', 'Miller', 'Davis', 'Rodriguez', 'Martinez', 'Hernandez', 'Lopez', 'Gonzalez', 'Wilson', 'Anderson', 'Thomas', 'Taylor', 'Moore', 'Jackson', 'Martin'];
        
        let generatedPatients = [];
        let selectedPatient = null;

        // Generate realistic SVG avatar based on age and gender
        function generateAvatar(age, gender) {
            const skinTones = ['#FDBCB4', '#F1C27D', '#E0AC69', '#C68642', '#8D5524'];
            const skinTone = skinTones[Math.floor(Math.random() * skinTones.length)];
            
            // Hair colors based on age
            let hairColors = age > 60 ? ['#C0C0C0', '#808080', '#FFFFFF', '#D3D3D3'] : 
                           age > 40 ? ['#4A4A4A', '#2C1810', '#8B7355', '#C0C0C0'] :
                           ['#2C1810', '#4A4A4A', '#8B4513', '#D2691E', '#000000'];
            const hairColor = hairColors[Math.floor(Math.random() * hairColors.length)];
            
            // Different hair styles based on gender and age
            const maleHairStyles = age > 60 ? ['bald', 'short', 'receding'] : ['short', 'medium', 'styled'];
            const femaleHairStyles = age > 60 ? ['short', 'bob', 'curly'] : ['long', 'medium', 'bob', 'curly'];
            const hairStyle = gender === 'male' ? 
                maleHairStyles[Math.floor(Math.random() * maleHairStyles.length)] :
                femaleHairStyles[Math.floor(Math.random() * femaleHairStyles.length)];
            
            // Generate SVG
            let svg = `
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 260" class="avatar-svg">
                    <!-- Background -->
                    <rect width="200" height="260" fill="url(#grad1)"/>
                    <defs>
                        <linearGradient id="grad1" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#E8F4FD;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#D1E7FF;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    
                    <!-- Neck -->
                    <rect x="85" y="140" width="30" height="40" fill="${skinTone}"/>
                    
                    <!-- Face -->
                    <ellipse cx="100" cy="100" rx="45" ry="55" fill="${skinTone}"/>
                    
                    <!-- Eyes -->
                    <ellipse cx="85" cy="95" rx="8" ry="10" fill="white"/>
                    <ellipse cx="115" cy="95" rx="8" ry="10" fill="white"/>
                    <circle cx="85" cy="95" r="4" fill="#4A4A4A"/>
                    <circle cx="115" cy="95" r="4" fill="#4A4A4A"/>
                    
                    <!-- Eyebrows -->
                    <path d="M 75 85 Q 85 82 95 85" stroke="${hairColor}" stroke-width="2" fill="none"/>
                    <path d="M 105 85 Q 115 82 125 85" stroke="${hairColor}" stroke-width="2" fill="none"/>
                    
                    <!-- Nose -->
                    <path d="M 100 100 L 95 115 L 100 118 L 105 115 Z" fill="${skinTone}" opacity="0.3"/>
                    
                    <!-- Mouth -->
                    <path d="M 85 125 Q 100 135 115 125" stroke="#C08081" stroke-width="2" fill="none"/>
            `;
            
            // Add hair based on style
            if (hairStyle === 'short' || hairStyle === 'medium') {
                svg += `<ellipse cx="100" cy="70" rx="48" ry="35" fill="${hairColor}"/>`;
            } else if (hairStyle === 'long') {
                svg += `
                    <ellipse cx="100" cy="70" rx="48" ry="35" fill="${hairColor}"/>
                    <rect x="52" y="70" width="96" height="80" fill="${hairColor}"/>
                `;
            } else if (hairStyle === 'bob') {
                svg += `
                    <ellipse cx="100" cy="70" rx="48" ry="35" fill="${hairColor}"/>
                    <ellipse cx="100" cy="120" rx="52" ry="40" fill="${hairColor}"/>
                `;
            } else if (hairStyle === 'curly') {
                svg += `<ellipse cx="100" cy="70" rx="52" ry="40" fill="${hairColor}"/>`;
                for (let i = 0; i < 5; i++) {
                    const x = 60 + Math.random() * 80;
                    const y = 50 + Math.random() * 40;
                    svg += `<circle cx="${x}" cy="${y}" r="15" fill="${hairColor}" opacity="0.8"/>`;
                }
            } else if (hairStyle === 'receding') {
                svg += `<path d="M 70 80 Q 100 60 130 80 L 130 50 Q 100 65 70 50 Z" fill="${hairColor}"/>`;
            }
            
            // Add wrinkles for older patients
            if (age > 50) {
                svg += `
                    <path d="M 70 90 L 75 90" stroke="#00000020" stroke-width="1"/>
                    <path d="M 125 90 L 130 90" stroke="#00000020" stroke-width="1"/>
                    <path d="M 80 130 Q 100 135 120 130" stroke="#00000020" stroke-width="1" fill="none"/>
                `;
            }
            
            // Add glasses for some patients
            if (Math.random() > 0.6) {
                svg += `
                    <rect x="70" y="88" width="25" height="20" fill="none" stroke="#333" stroke-width="2" rx="5"/>
                    <rect x="105" y="88" width="25" height="20" fill="none" stroke="#333" stroke-width="2" rx="5"/>
                    <path d="M 95 98 L 105 98" stroke="#333" stroke-width="2"/>
                `;
            }
            
            // Body/Clothing
            svg += `
                <rect x="50" y="170" width="100" height="90" fill="#4A90E2" rx="10"/>
                <rect x="90" y="170" width="20" height="30" fill="#FFFFFF"/>
            `;
            
            svg += '</svg>';
            return svg;
        }

        // Generate realistic patient data
        function generatePatientData(ageRange, gender) {
            const [minAge, maxAge] = ageRange.split('-').map(Number);
            const age = minAge + Math.floor(Math.random() * (maxAge - minAge + 1));
            
            const actualGender = gender === 'mixed' ? (Math.random() > 0.5 ? 'male' : 'female') : gender;
            const firstName = firstNames[actualGender][Math.floor(Math.random() * firstNames[actualGender].length)];
            const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
            
            // Generate chronic diseases based on age
            const chronicDiseases = [];
            if (age > 40 && Math.random() > 0.6) chronicDiseases.push('diabetes');
            if (age > 35 && Math.random() > 0.5) chronicDiseases.push('hypertension');
            if (chronicDiseases.length === 0 && Math.random() > 0.4) chronicDiseases.push('none');
            
            // Cancer type
            const cancerTypes = ['leukemia', 'lymphoma'];
            const cancer = cancerTypes[Math.floor(Math.random() * cancerTypes.length)];
            
            // Vital signs with age-appropriate variations
            const temp = (36.5 + Math.random() * 1.2).toFixed(1);
            const systolic = age > 60 ? 130 + Math.floor(Math.random() * 30) : 110 + Math.floor(Math.random() * 30);
            const diastolic = age > 60 ? 70 + Math.floor(Math.random() * 20) : 60 + Math.floor(Math.random() * 20);
            const hr = age < 18 ? 70 + Math.floor(Math.random() * 40) : 60 + Math.floor(Math.random() * 30);
            
            return {
                id: Date.now() + Math.random(),
                firstName,
                lastName,
                age,
                gender: actualGender,
                chronicDiseases: chronicDiseases.length > 0 ? chronicDiseases : ['none'],
                cancer,
                temperature: temp,
                bloodPressure: `${systolic}/${diastolic}`,
                heartRate: hr,
                avatar: generateAvatar(age, actualGender)
            };
        }

        // Generate batch of patients
        function generatePatientBatch() {
            const ageRange = document.getElementById('ageRange').value;
            const genderDist = document.getElementById('genderDist').value;
            const cancerType = document.getElementById('cancerType').value;
            const count = parseInt(document.getElementById('patientCount').value);
            
            generatedPatients = [];
            const gallery = document.getElementById('patientGallery');
            gallery.innerHTML = '';
            
            for (let i = 0; i < count; i++) {
                const patient = generatePatientData(ageRange, genderDist);
                if (cancerType !== 'mixed') {
                    patient.cancer = cancerType;
                }
                generatedPatients.push(patient);
                
                // Create patient card
                const card = document.createElement('div');
                card.className = 'patient-card';
                card.dataset.patientId = patient.id;
                card.onclick = () => selectPatient(patient.id);
                
                card.innerHTML = `
                    <div class="selection-indicator">âœ“</div>
                    <div class="patient-avatar">${patient.avatar}</div>
                    <div class="patient-info">
                        <div class="patient-name">${patient.firstName} ${patient.lastName}</div>
                        <div class="patient-details">
                            <span><strong>Age:</strong> ${patient.age} years</span>
                            <span><strong>Gender:</strong> ${patient.gender}</span>
                            <span><strong>Cancer:</strong> ${patient.cancer}</span>
                            <span><strong>Chronic:</strong> ${patient.chronicDiseases.join(', ')}</span>
                        </div>
                        <div class="vital-signs">
                            <div class="vital-badge">${patient.temperature}Â°C</div>
                            <div class="vital-badge">${patient.bloodPressure}</div>
                            <div class="vital-badge">${patient.heartRate} bpm</div>
                        </div>
                    </div>
                `;
                
                gallery.appendChild(card);
            }
            
            updateStats();
        }

        // Select a patient
        function selectPatient(patientId) {
            // Remove previous selection
            document.querySelectorAll('.patient-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selection to clicked card
            const selectedCard = document.querySelector(`[data-patient-id="${patientId}"]`);
            selectedCard.classList.add('selected');
            
            // Store selected patient
            selectedPatient = generatedPatients.find(p => p.id === patientId);
            
            // Auto-fill parent form if it exists
            if (window.parent && window.parent.document) {
                try {
                    const parentDoc = window.parent.document;
                    if (parentDoc.getElementById('age')) {
                        parentDoc.getElementById('age').value = selectedPatient.age;
                        parentDoc.getElementById('sex').value = selectedPatient.gender;
                        parentDoc.getElementById('cancer').value = selectedPatient.cancer;
                        parentDoc.getElementById('temperature').value = selectedPatient.temperature;
                        parentDoc.getElementById('bloodPressure').value = selectedPatient.bloodPressure;
                        parentDoc.getElementById('heartRate').value = selectedPatient.heartRate;
                        
                        // Handle chronic diseases
                        const chronicSelect = parentDoc.getElementById('chronicDiseases');
                        if (chronicSelect) {
                            for (let option of chronicSelect.options) {
                                option.selected = selectedPatient.chronicDiseases.includes(option.value);
                            }
                        }
                    }
                } catch (e) {
                    console.log('Running standalone');
                }
            }
        }

        // Select random patient
        function selectRandomPatient() {
            if (generatedPatients.length > 0) {
                const randomPatient = generatedPatients[Math.floor(Math.random() * generatedPatients.length)];
                selectPatient(randomPatient.id);
            }
        }

        // Update statistics
        function updateStats() {
            document.getElementById('totalPatients').textContent = generatedPatients.length;
            
            if (generatedPatients.length > 0) {
                const avgAge = Math.round(generatedPatients.reduce((sum, p) => sum + p.age, 0) / generatedPatients.length);
                document.getElementById('avgAge').textContent = avgAge;
                
                const maleCount = generatedPatients.filter(p => p.gender === 'male').length;
                const femaleCount = generatedPatients.filter(p => p.gender === 'female').length;
                document.getElementById('maleCount').textContent = maleCount;
                document.getElementById('femaleCount').textContent = femaleCount;
            }
        }

        // Initialize with sample patients on load
        window.onload = () => {
            generatePatientBatch();
        };
    </script>
</body>
</html>